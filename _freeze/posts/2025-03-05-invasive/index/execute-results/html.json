{
  "hash": "11739a2ca022291dc305fc6b99a36b72",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Mapping Red Sesbania Invasion in California\"\nauthor: \"Zoe Zhou\"\ndate: 03-05-2025\nimage: preview.jpg\ncategories: [R, Spatial Analysis]\nformat: \n  html:\n    code-fold: true\n    embed-resources: true\n    toc: true\nexecute:\n  warning: false\n  message: false\ntheme: minty\n---\n\n\n\n### About\n\nFirst introduced as an ornamental plant, red sesbania (Sesbania punicea) now threatens California's river systems, particularly in the Central Valley and Delta regions. It grows up to 15 feet tall with bright red-orange flowers that make it visually appealing but ecologically destructive. This post demonstrates how to use R to analyze California county geography and track the spread of an invasive plant species.\n\n\n### Setup\nTo begin analyzing this species' distribution, I'll use R's spatial packages:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(broom)\nlibrary(ggplot2)\nlibrary(ggspatial)\nlibrary(knitr)\nlibrary(kableExtra)\n# Spatial data packages\nlibrary(sf)\n```\n:::\n\n\nFirst, I'll import and clean the California county shapefile. When working with spatial data, knowing the coordinate reference system (CRS) is essential.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_counties_raw_sf <- read_sf(here(\"posts\",\"2025-03-05-invasive\",\"data\", \"ca_counties\", \"CA_Counties_TIGER2016.shp\"))\n\nca_counties_sf <- ca_counties_raw_sf %>% \n  janitor::clean_names() %>% \n  mutate(land_km2 = aland/1e6) %>% \n  select(county=name, land_km2)\n\nca_counties_sf |>  st_crs()\n```\n:::\n\n\n\nThis shows we're using the \"pseudo-mercator\" projection based on WGS 84 (EPSG:3857), commonly used for web mapping applications.\n\n### Mapping California Counties\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# area as gradient just on california\nggplot(ca_counties_sf)+\n  geom_sf(aes(fill = land_km2), color='white',size=0.1)+\n  theme_minimal() +\n  scale_fill_gradientn(colors = c(\"cyan\",\"blue\",\"purple\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n### Analyzing Red Sesbania Distribution\n\nRead in invasive red sesbania records as spatial points and standardize their coordinate:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Read in data with sf\nsesbania_sf <- read_sf(here(\"posts\",\"2025-03-05-invasive\",\"data\",\"red_sesbania\",\"ds80_for_lab.gpkg\")) |> \n  janitor::clean_names()\n\n# Confirm CRS transformation\nsesbania_3857_sf <- st_transform(sesbania_sf, 3857)\n# Then check it: \n#sesbania_3857_sf |>  st_crs() \n```\n:::\n\n\n\n### Spatial Joining for Ecological Analysis\n\nThe Big Question: Where is this plant located? I'm really curious about which counties have the most sesbania observations. Let's use a spatial join to figure this out:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nca_sesb_sf <- ca_counties_sf |> \n  st_join(sesbania_3857_sf)\n\n#head(ca_sesb_sf)\n```\n:::\n\n\n\nNow we can count observations by county. Use the CA polygons`sf` object with the CA polygons to summarize the total number of sesbania in each. Watch out for `NAs`!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsesb_counts_sf <- ca_sesb_sf |> \n  group_by(county) |> \n  summarize(n_records = sum(!is.na(id)))\n\n# Show a table of top ten \nsesb_counts_sf %>%\n  st_drop_geometry() %>%  # Crucial step to remove spatial component\n  arrange(desc(n_records)) %>%\n  slice_head(n = 10) %>%\n  kable(\n    format = \"html\",\n    col.names = c(\"County\", \"Number of Records\"),\n    caption = \"Top 10 Counties by SESB Record Count\"\n  ) %>%\n  kable_styling(\n    bootstrap_options = c(\"striped\", \"hover\", \"condensed\"),\n    full_width = FALSE,\n    position = \"center\"\n  )\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover table-condensed\" style=\"width: auto !important; margin-left: auto; margin-right: auto;\">\n<caption>Top 10 Counties by SESB Record Count</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> County </th>\n   <th style=\"text-align:right;\"> Number of Records </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Solano </td>\n   <td style=\"text-align:right;\"> 33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Sacramento </td>\n   <td style=\"text-align:right;\"> 17 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> San Joaquin </td>\n   <td style=\"text-align:right;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Butte </td>\n   <td style=\"text-align:right;\"> 5 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Contra Costa </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Napa </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Placer </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Shasta </td>\n   <td style=\"text-align:right;\"> 4 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Yolo </td>\n   <td style=\"text-align:right;\"> 3 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Nevada </td>\n   <td style=\"text-align:right;\"> 2 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n### Mapping Red Sesbania Distribution by County\n\nLet's create a heat map showing which counties have the most sesbania records: we can plot a choropleth using the number of records for red sesbania as the fill color.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = sesb_counts_sf) +\n  # Add a basemap for geographic context\n  annotation_map_tile(type = \"osm\", zoom = 6) +\n\n  # County polygons with transparency\n  geom_sf(aes(fill = n_records), \n          color = \"white\", \n          size = 0.1, \n          alpha = 0.7) +\n\n  # Improved color gradient\n  scale_fill_gradientn(\n    colors = c(\"lightgray\", \"orange\", \"darkred\"),\n    name = \"Number of\\nS. punicea Records\"\n  ) +\n\n  # Professional theme\n  theme_minimal() +\n\n  # Comprehensive labels\n  labs(\n    title = \"Spatial Distribution of S. punicea Records in California Counties\",\n    subtitle = \"Variation in Record Counts Across Counties\",\n    fill = \"Number of\\nRecords\"\n  ) +\n\n  # Additional theme refinements\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    plot.subtitle = element_text(face = \"italic\", size = 10),\n    plot.caption = element_text(size = 8, color = \"gray50\"),\n    legend.position = \"right\",\n    legend.title = element_text(face = \"bold\"),\n    axis.text = element_text(size = 8),\n    panel.background = element_rect(fill = \"aliceblue\", color = NA)\n  ) +\n\n  # Add scale bar and north arrow\n  annotation_scale(location = \"bl\") +\n  annotation_north_arrow(\n    location = \"tr\", \n    which_north = \"true\",\n    pad_x = unit(0.2, \"in\"), \n    pad_y = unit(0.2, \"in\"),\n    style = north_arrow_fancy_orienteering\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\nThis map really drives home the pattern: Sesbania appears to be concentrated along river systems in the Central Valley. I suspect the Sacramento-San Joaquin Delta might be facilitating its spread - water systems are like highways for invasive species! \n\n### Zooming In: A Closer Look at Invasion Hotspots\n\nI wondered which counties are dealing with the most sesbania, so I identified the top county and created a focused map:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#arrange(desc(as.data.frame(sesb_counts_sf)$n_records))\n#arrange(desc(sesb_counts_sf$n_records))\n\nsesb_counties_sf <- sesbania_3857_sf |> \n  st_join(ca_counties_sf)\n\n# Subset of sesbania point locations only in Solano County\n\ncounty_max <- sesb_counts_sf %>%\n  filter(n_records == max(n_records)) %>%\n  pull(county)\n\n### we appended the county names to Sesbania records earlier:\nsolano_sesb_sf <- sesb_counties_sf %>% \n  filter(county == county_max) ### what if two counties had the same max value?\n\n# Only keep Solano polygon from California County data\nsolano_sf <- ca_counties_sf %>% \n  filter(county %in% county_max)\n\nggplot() +\n  # Use a more visually appealing color palette\n  annotation_map_tile(type = \"osm\", zoom = 9) +\n  geom_sf(data = solano_sf, fill = \"#E6F2FF\", color = \"#4A4A4A\", linewidth = 0.5, alpha=0.7) +\n  geom_sf(data = solano_sesb_sf, color = 'red', size = 2) +\n\n  # Add a title and subtitle\n  labs(\n    title = \"Solano County Map\",\n    subtitle = \"Highlighting Red Sesbania Locations\",\n    x = \"Longitude\",\n    y = \"Latitude\"\n  ) +\n\n  # Improve overall theme\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5),\n    axis.text = element_text(size = 10),\n    panel.grid.major = element_line(color = \"#DDDDDD\", linetype = \"dashed\")\n  ) +\n\n  # Add scale bar and north arrow\n  annotation_scale(location = \"bl\", width_hint = 0.5) +\n  annotation_north_arrow(\n    location = \"tr\", \n    which_north = \"true\",\n    pad_x = unit(0.5, \"in\"), \n    pad_y = unit(0.5, \"in\"),\n    style = north_arrow_fancy_orienteering\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n### Wrapping Up\n\nWhat started as a simple exploration of maps has revealed a compelling ecological story. Through the power of spatial analysis, we've been able to visualize both California's geography and the distribution of an invasive species threatening its ecosystems.\n\nThe spatial analysis reveals that red sesbania is primarily concentrated along river systems in the Central Valley. This distribution pattern suggests water-based dispersal is a key factor in its spread, particularly in the Sacramento-San Joaquin Delta region.\n\nThis type of spatial analysis has practical applications for: targeting removal efforts in invasion hotspots; predicting future spread patterns; allocating resources for invasive species management; and protecting vulnerable ecosystems from further invasion. \n\n### Acknowledgements\n\nThis analysis contains materials prepared by Nathan Grimes, Yutian Fang, Casey O'Hara and Allison Horst for the course ESM 244 - Advance Data Analysis. This course is part of the UCSB Masters in Environmental Science and Management. Data and other exercises can be access on this [Github Repository](https://github.com/nggrimes/esm-244-w25-lab7)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}